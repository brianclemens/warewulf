<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/warewulf/news/rss.xml" title="Warewulf Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/warewulf/news/atom.xml" title="Warewulf Blog Atom Feed"><title data-react-helmet="true">Architecture | Warewulf</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Architecture | Warewulf"><meta data-react-helmet="true" name="description" content="Warewulf&#x27;s primary design goal is to facilitate software installation, configuration and management on the most common architecture for an HPC cluster nowadays. This popular cluster design originated 25 years ago with the seminal commodity-off-the-shelf (COTS) architecture commonly known as the &quot;Beowulf&quot;."><meta data-react-helmet="true" property="og:description" content="Warewulf&#x27;s primary design goal is to facilitate software installation, configuration and management on the most common architecture for an HPC cluster nowadays. This popular cluster design originated 25 years ago with the seminal commodity-off-the-shelf (COTS) architecture commonly known as the &quot;Beowulf&quot;."><meta data-react-helmet="true" property="og:url" content="https://ctrliq.github.io/warewulf/docs/about/architecture"><link data-react-helmet="true" rel="shortcut icon" href="/warewulf/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://ctrliq.github.io/warewulf/docs/about/architecture"><link rel="stylesheet" href="/warewulf/styles.3a5b2d86.css">
<link rel="preload" href="/warewulf/styles.2ed7e5c0.js" as="script">
<link rel="preload" href="/warewulf/runtime~main.2daa28ad.js" as="script">
<link rel="preload" href="/warewulf/main.f6cb9033.js" as="script">
<link rel="preload" href="/warewulf/1.4c21c66e.js" as="script">
<link rel="preload" href="/warewulf/2.38fa5209.js" as="script">
<link rel="preload" href="/warewulf/45.609486e8.js" as="script">
<link rel="preload" href="/warewulf/47.6b542347.js" as="script">
<link rel="preload" href="/warewulf/935f2afb.5c8540bc.js" as="script">
<link rel="preload" href="/warewulf/17896441.1a2bd3df.js" as="script">
<link rel="preload" href="/warewulf/1f1ca1a6.f1c18156.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/warewulf/"><img src="/warewulf/img/logo.png" alt="Warewulf Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/warewulf/img/logo.png" alt="Warewulf Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Warewulf</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/warewulf/docs/">Docs</a><a class="navbar__item navbar__link" href="/warewulf/news">News</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ctrliq/warewulf" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/warewulf/"><img src="/warewulf/img/logo.png" alt="Warewulf Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/warewulf/img/logo.png" alt="Warewulf Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Warewulf</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/warewulf/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/warewulf/news">News</a></li><li class="menu__list-item"><a href="https://github.com/ctrliq/warewulf" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/warewulf/docs/">Introduction</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/warewulf/docs/about/architecture">Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/warewulf/docs/about/security">Security</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/warewulf/docs/about/templating">Templating</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Prerequisites</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/prerequisites/hardware">Hardware</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/prerequisites/software">Software</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/getting-started/quickstart-el7">Quick Start for RHEL and CentOS 7</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/getting-started/quickstart-el8">Quick Start for RHEL, CentOS, and Rocky 8</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">wwctl</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/wwctl/configure">wwctl configure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/wwctl/container">wwctl container</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/wwctl/controller">wwctl controller</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/wwctl/kernel">wwctl kernel</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/wwctl/node">wwctl node</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/wwctl/overlay">wwctl overlay</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/wwctl/power">wwctl power</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/wwctl/profile">wwctl profile</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/wwctl/ready">wwctl ready</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/wwctl/server">wwctl server</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/wwctl">wwctl</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Contributing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/contributing/contributing">Contributing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/contributing/documentation">Documentation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/contributing/development-environment-kvm">Development Environment (KVM)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/contributing/development-environment-vbox">Development Environment (VirtualBox)</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Appendix</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/warewulf/docs/appendix/glossary">Glossary</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Architecture</h1></header><div class="markdown"><p>Warewulf&#x27;s primary design goal is to facilitate software installation, configuration and management on the most common architecture for an HPC cluster nowadays. This popular cluster design originated 25 years ago with the seminal commodity-off-the-shelf (COTS) architecture commonly known as the &quot;Beowulf&quot;.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="the-beowulf"></a>The Beowulf<a class="hash-link" href="#the-beowulf" title="Direct link to heading">#</a></h2><p>The original <a href="https://en.wikipedia.org/wiki/Beowulf_cluster" target="_blank" rel="noopener noreferrer">Beowulf Cluster</a> was developed in 1996 by Dr. Thomas Sterling and Dr. Donald Becker at NASA. The architecture is defined as a group of similar compute worker nodes all connected together using standard commodity equipment on a private network segment. The control node is dual homed (has two network interface cards) with one of these network interface cards attached to the upstream network and the other connected to the same private network which connects the compute worker nodes (as seen in the figure below).</p><p>.. image:: /images/beowulf_architecture.png</p><p>This architecture is very advantageous for creating a scalable HPC cluster resource, but it is an overly simple portrayal of the cluster ecosystem. To this thumbnail sketch we must add storage, scheduling and resource management, monitoring, interactive systems, and as the system grows, it may need to have groups of nodes with different features, architectures, vintages, memory configurations, GPUs or interconnects. As the system grows more complex, the need for a scalable control surface also increases which can result in even more complexity.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="provisioning"></a>Provisioning<a class="hash-link" href="#provisioning" title="Direct link to heading">#</a></h2><p>Warewulf is designed to support the simplest of clusters, but also the most complicated, largest, and specialized resources that are in demand today. But when implementing all the various configurations, we rely on the basic architecture illustrated above. We can rely on such a simple schematic because Warewulf is designed to &quot;own&quot; the network broadcast domain and manage how these worker nodes boot.</p><p>As mentioned before, Warewulf is designed first and foremost to be a stateless provisioning subsystem. This means that the worker nodes maintain no state about their configuration, operating system or purpose when they are powered off. So, when these systems boot, they retain no knowledge of who they are, what they are supposed to do or how they got there. For these reasons, the worker nodes will need to boot via <a href="https://en.wikipedia.org/wiki/Preboot_Execution_Environment" target="_blank" rel="noopener noreferrer">PXE</a> in order to retrieve a personality and a purpose.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pxe"></a>PXE<a class="hash-link" href="#pxe" title="Direct link to heading">#</a></h2><p>Most servers will have network interface cards that support PXE by default. In a nutshell, PXE will allow the network card to be seen by the BIOS as a bootable device. This means that the boot order may need to be configured in the system&#x27;s BIOS on the worker nodes to allow it to boot. If there is also another bootable device on these systems, it might be necessary to set the network interface card to boot first.</p><p>When the system boots via PXE, it will begin a chain reaction of events:</p><ol><li>The network card will register an option ROM into the BIOS</li><li>The BIOS will run through all of its functions and finish with boot devices</li><li>The boot devices are attempted to be booted in the defined order</li><li>When it gets to the network boot device, PXE is run from the firmware on the network card</li><li>PXE will request a BOOTP/DHCP address on the network which is handled by the controller node</li><li>If the DHCP response includes a boot file name, it will download this file (iPXE boot image) over TFTP</li><li>Once iPXE is downloaded, it is loaded by the network card and it will request a configuration from the
controller node</li><li>The configuration will tell iPXE what to download and load</li></ol><p>Warewulf manages the entire process once the worker node&#x27;s network device has begun the PXE process.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="warewulf-server"></a>Warewulf Server<a class="hash-link" href="#warewulf-server" title="Direct link to heading">#</a></h2><p>Warewulf will configure the controller&#x27;s DHCP and TFTP services and put all the required files into place. But once the iPXE file has been sent and loaded on the worker nodes, all network communication from this point on is handled by the Warewulf server on the controller node over HTTP. The order of events from this point on is as follows:</p><ol><li>iPXE requests its configuration and Warewulf generates this on demand from the configured template</li><li>The default iPXE template tells iPXE to request a kernel, VNFS image, runtime kernel modules and a system overlay</li><li>Each of the requested files will be sent to the worker node</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="post-pxe"></a>Post PXE<a class="hash-link" href="#post-pxe" title="Direct link to heading">#</a></h2><p>Once the worker node has received all the required files, the kernel will boot, and the runtime components will be loaded into the kernel&#x27;s initial RAM file system (initramfs). The order of these processes is important because each layer is dependent on the previous. The layers are implemented in the following order:</p><ol><li>VNFS/Container image</li><li>Kernel modules</li><li>System Overlay</li><li>Runtime Overlay (repeated at a given interval)</li></ol><p>As part of the provisioning process, the system boots after the System Overlay has been provisioned, which means that the Runtime Overlay occurs after <code>/sbin/init</code> has been called on the system. This delineation is important because it clearly defines what should be in the system versus runtime overlay. More on overlays in the next section.</p><p>Before calling <code>/sbin/init</code> (or <code>init</code> to override in the node configuration file), Warewulf must set up the system. Again, this process occurs after the System Overlay has been provisioned. This is where the system initializes and prepares for booting the runtime OS. Depending on the configuration, the system might boot directly in the initramfs file system as it stands, or it could migrate the root file system to a different mount point (e.g. <code>tmpfs</code>or at some point, hard drives).</p><p>Other things that get done at this stage are setting up and enabling SELinux, IPMI, making any needed changes or configurations to the file system before booting it and starting up the <code>wwclient</code> which is responsible for loading the runtime overlay.</p><p>Lastly, the <code>init</code> process is executed with PID 1 and thus &quot;boots&quot; the VNFS container. This is where SysVInit, Upstart, or Systemd takes over.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="warewulf-overlays"></a>Warewulf Overlays<a class="hash-link" href="#warewulf-overlays" title="Direct link to heading">#</a></h2><p>As described above, Warewulf uses layers to provision worker nodes in phases. The first layer is static across any number of nodes, but each node may require some custom configurations, for example, network. This means there must be a method for leveraging a base file system (VNFS) that can be shared by many nodes and also be able to configure these file systems with custom per-node options at a large scale.</p><p>Typically, there are two major times this configuration needs to be done-- pre &quot;boot&quot; and post &quot;boot&quot;. In this case, as described above, we can consider the call to <code>/sbin/init</code> the delineation point and the proper way to consider the two configurable overlays: system and runtime.</p><p><strong>System Overlay</strong>: The system overlay is what will be present before <code>/sbin/init</code> is called. This gives the administrator the ability to control the configuration of the booting system itself. For example, network configuration must be addressed on every node, but each node must have a slightly different network configuration otherwise the IP addresses will clash. This must be set before Systemd brings up the network device, so the Warewulf system overlay is the right place to configure this.</p><p><strong>Runtime Overlays</strong>: Some configurations happen after the system boots and continuously at periodic intervals. For example, user and group accounts. You probably don&#x27;t want to reprovision a node, let alone hundreds of nodes, to add a user or change a runtime configuration, and this is where you should use the runtime overlay.</p><p>Both overlays leverage a similar file system template structure. Each overlay (you can create any number of them) can include text files, directories, links and templates. Templates allow you to dynamically customize any of the content within an overlay for each node that will be leveraging that template.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/ctrliq/warewulf/edit/main/docs/docs/about/architecture.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/warewulf/docs/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/warewulf/docs/about/security"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Security Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-beowulf" class="table-of-contents__link">The Beowulf</a></li><li><a href="#provisioning" class="table-of-contents__link">Provisioning</a></li><li><a href="#pxe" class="table-of-contents__link">PXE</a></li><li><a href="#warewulf-server" class="table-of-contents__link">Warewulf Server</a></li><li><a href="#post-pxe" class="table-of-contents__link">Post PXE</a></li><li><a href="#warewulf-overlays" class="table-of-contents__link">Warewulf Overlays</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/warewulf/docs">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/hpcng/shared_invite/zt-ll5c3ofb-XhvMPbXUhTVrHlutQz2jbA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCQbKq1vIffqRAMUDPfHcU0w" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/warewulf/news">News</a></li><li class="footer__item"><a href="https://github.com/ctrliq/warewulf" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Ctrl IQ, Inc. - All Rights Reserved.</div></div></div></footer></div>
<script src="/warewulf/styles.2ed7e5c0.js"></script>
<script src="/warewulf/runtime~main.2daa28ad.js"></script>
<script src="/warewulf/main.f6cb9033.js"></script>
<script src="/warewulf/1.4c21c66e.js"></script>
<script src="/warewulf/2.38fa5209.js"></script>
<script src="/warewulf/45.609486e8.js"></script>
<script src="/warewulf/47.6b542347.js"></script>
<script src="/warewulf/935f2afb.5c8540bc.js"></script>
<script src="/warewulf/17896441.1a2bd3df.js"></script>
<script src="/warewulf/1f1ca1a6.f1c18156.js"></script>
</body>
</html>